<!DOCTYPE html>

<html lang="en">
  <head>
    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/24.7/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

 	<style>
  .speech-bubble {
    background: #efefef;
    -webkit-border-radius: 4px;
            border-radius: 4px;
    font-size: 1rem;
    line-height: 1.3;
    margin: 0 auto 40px;
    max-width: 150px;
    padding: 15px;
    position: absolute;
    top:0px;
    left:500px;
    display:none;
  } 

  .speech-bubble p {
    margin: 0 0 10px;
  }
  .speech-bubble p:last-of-type {
    margin-bottom: 0;
  }

  .speech-bubble::after {
    border-left: 20px solid transparent;
    border-top: 20px solid #efefef;
    bottom: -20px;
    content: "";
    position: absolute;
    right: 20px;
   }
 	.map
 	{
 		position: relative;
 		top: 0;
 		left: 0;

 	}
 	.red_x
 	{
 		position: absolute;
 		top: 500px;
 		left: 500px;
 	}
 	</style>
 </head>

 <body>
   <button onclick="pinDrop(475,375)">move button</button>
   <button onclick="zoomIn()">zoom in </button>
   <button onclick="zoomOut()">zoom out </button>
   <button onclick="status()">status</button>
   
 	<div style="position: relative; left: 0; top: 0;">
 		<img id = "map" src="map.jpg" class="map"/>
 	</div>
  <div class="speech-bubble">
    <p><strong>Demo speech bubble</strong></p>
  </div>

  <script>
    //var realHeight = document.getElementById("map").height * 1.0;
    var realWidth = document.getElementById("map").width * 1.0;
    var zoomLevel = 0;
    //left off implementing realTop and realLeft for bubbles position, same as realWidth, account for multiplicative truncation.
    function loadImage(img){
      document.getElementById("map").src = img;
    }

  	//pinDrop function, passes in x and y paramaters and drops pin at that location.
    function pinDrop(x,y) {
      if(zoomLevel<0){
        while(zoomLevel<0){
          zoomIn();
        }
      }
      while(zoomLevel>0){
        zoomOut();
      }
      displayInfo("CSEL 150")
      document.getElementsByClassName("speech-bubble")[0].style.display = "block";
      document.getElementsByClassName("speech-bubble")[0].style.top = (y-document.getElementsByClassName("speech-bubble")[0].offsetHeight+10) + "px";
      document.getElementsByClassName("speech-bubble")[0].style.left = (x-document.getElementsByClassName("speech-bubble")[0].offsetWidth+20) + "px";
      //alert(document.getElementsByClassName("speech-bubble")[0].style.height);
      
      while(zoomLevel!=5){
        zoomIn();
      }
      document.documentElement.scrollLeft = x * Math.pow(8/7,zoomLevel) - window.innerWidth/2;
      document.documentElement.scrollTop = y * Math.pow(8/7,zoomLevel) - window.innerHeight/2;
	  }
    function displayInfo(roomNum){
      document.getElementsByClassName("speech-bubble")[0].innerHTML = roomNum;
    }

	function zoomIn(){
    zoomLevel++;
		realWidth = parseFloat(realWidth* (8/7));
    document.getElementById("map").width = realWidth;
		var pixelCords = document.getElementsByClassName("speech-bubble")[0];
    document.getElementsByClassName("speech-bubble")[0].style.top = (((pixelCords.offsetTop-pixelCords.offsetHeight+10)*(8/7)) + (pixelCords.offsetHeight)+1.5) + "px";
    document.getElementsByClassName("speech-bubble")[0].style.left = ((((pixelCords.offsetLeft)-pixelCords.offsetWidth+20)*(8/7)) + (pixelCords.offsetWidth)+2.7) + "px";
    document.documentElement.scrollTop  = ((document.documentElement.scrollTop+(window.innerHeight/2)) * 8/7) - (window.innerHeight/2);
    document.documentElement.scrollLeft = ((document.documentElement.scrollLeft +(window.innerWidth/2)) * 8/7) - (window.innerWidth/2);
  }
	function zoomOut(){
    zoomLevel--;
    realWidth = parseFloat(realWidth* (7/8));
		document.getElementById("map").width =realWidth.toFixed(0);
		var pixelCords = document.getElementsByClassName("speech-bubble")[0];
    document.getElementsByClassName("speech-bubble")[0].style.top = (((pixelCords.offsetTop-pixelCords.offsetHeight-10)*(7/8)) + (pixelCords.offsetHeight))-2+ "px";
    document.getElementsByClassName("speech-bubble")[0].style.left = ((((pixelCords.offsetLeft)-pixelCords.offsetWidth-20)*(7/8)) + (pixelCords.offsetWidth))-4 + "px";
    document.documentElement.scrollTop  = (document.documentElement.scrollTop+(window.innerHeight/2) * 7/8) - window.innerHeight/2;
    document.documentElement.scrollLeft = (document.documentElement.scrollLeft +(window.innerWidth/2) * 7/8) - window.innerWidth/2;
	}


  function status(){
      alert("LeftScroll: " + document.documentElement.scrollLeft + "\nTopScroll: " + document.documentElement.scrollTop + "\nCenter: "+ (document.documentElement.scrollLeft+(window.innerWidth/2))+","+(document.documentElement.scrollTop+(window.innerHeight/2)) + "\nWidth"+window.innerWidth);
  		var pixelCords = document.getElementsByClassName("speech-bubble")[0];
  		alert("Left: " + pixelCords.offsetLeft +"\nTop: " +pixelCords.offsetTop +"\nWidth: "+ document.getElementById("map").width + "\n Height: " + document.getElementById("map").height);
	}
 function loadInfo(roomNum,x,y,img){
  if(document.getElementById("map").src != img){
    document.getElementById("map").src = img;
  }
  displayInfo(roomNum);
  pinDrop(x,y);
 }
  </script>
 </body>
 </html>
